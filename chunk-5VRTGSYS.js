import{a as I}from"./chunk-FVNS5QYO.js";import{c as k,e as c,f as g,h,i as f,k as l,n as E,q as s,qa as T,r as p,xa as a}from"./chunk-PJ25VLX2.js";var n=class{constructor(i,u,t,e){this.email=i,this.id=u,this._token=t,this._tokeExpirationDate=e}get token(){return!this._tokeExpirationDate||new Date>this._tokeExpirationDate?null:this._token}};var w=(()=>{let i=class i{constructor(t,e,r){this.cartService=t,this.http=e,this.router=r,this.user=new k(null)}addToUserOrders(){this.userOrders=this.cartService.getCartItems().slice()}getUserOrder(){return this.userOrders}signUp(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyCdjP-huFSi8Nvo1icqhc4UrmiJTAtZMNk",{email:t,password:e,returnSecureToken:!0}).pipe(h(this.handleError),l(r=>{this.handleAuthentication(r.email,r.localId,r.idToken,+r.expiresIn)}))}login(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyCdjP-huFSi8Nvo1icqhc4UrmiJTAtZMNk",{email:t,password:e,returnSecureToken:!0}).pipe(h(this.handleError),l(r=>{this.handleAuthentication(r.email,r.localId,r.idToken,+r.expiresIn)}))}autoLogin(){let t=JSON.parse(localStorage.getItem("userData"));if(!t)return;let e=new n(t.email,t.id,t._token,new Date(t._tokenExpirationDate));e.token&&this.user.next(e),this.tokenExpirationTimer=null}logout(){this.user.next(null),this.router.navigate(["/home"]),localStorage.removeItem("userData"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer)}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}handleError(t){let e=new Error("Unknown error occured");if(!t.error||!t.error.error)return c(()=>e);switch(t.error.error.message){case"EMAIL_EXISTS":e=new Error("The email address is already in use by another account.");break;case"EMAIL_NOT_FOUND":e=new Error("There is no user record corresponding to this identifier. The user may have been deleted.");break;case"INVALID_LOGIN_CREDENTIALS":e=new Error("The password or the email is invalid.");break}return c(()=>e)}handleAuthentication(t,e,r,m){let S=new Date(new Date().getTime()+m*1e3),d=new n(t,e,r,S);this.user.next(d),this.autoLogout(m*1e3),localStorage.setItem("userData",JSON.stringify(d))}};i.\u0275fac=function(e){return new(e||i)(s(I),s(T),s(a))},i.\u0275prov=E({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var C=(o,i)=>{let u=p(w),t=p(a);return u.user.pipe(f(1),g(e=>e?!0:t.createUrlTree(["/login"])))};export{w as a,C as b};
